/**
 * Created by haoxiaotian on 2016/11/22 18:59.
 * version 1.0
 */
-- DROP DATABASE IF EXISTS `MUSIC_SITE`;
-- CREATE DATABASE `MUSIC_SITE`;
-- USE `MUSIC_SITE`;

CREATE TABLE AUTH_USER(
    `ID` INT NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    `UID` VARCHAR(255) NOT NULL COMMENT '教职工工号',
    `USERNAME` VARCHAR(60) NOT NULL COMMENT '用户姓名',
    `AGE` INT NOT NULL COMMENT '年龄',
    `TEL` VARCHAR(20) NOT NULL COMMENT '电话号码',
    `PASSWORD` CHAR(32) NOT NULL COMMENT '密码',
    `SALT` CHAR(32) NOT NULL COMMENT 'MD5 盐',
    `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）',
     KEY uid_index(UID) COMMENT '根据工号 B+ 树索引'
#    TODO:索引根据具体查询，后期再加
 )ENGINE = INNODB AUTO_INCREMENT = 1 CHARSET=UTF8 COMMENT = '系统用户表';



CREATE TABLE AUTH_ROLE(
  `ID` INT NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '角色ID',
  `NAME` VARCHAR(255) NOT NULL COMMENT '角色名',
  `E_NAME` VARCHAR(255) NOT NULL COMMENT '角色英文名',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）'
#    TODO:索引根据具体查询，后期再加
)ENGINE = INNODB AUTO_INCREMENT = 1 DEFAULT CHARSET=UTF8 COMMENT = '系统角色表';


CREATE TABLE AUTH_PERMISSION(
  `ID` INT NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '权限ID',
  `NAME` VARCHAR(255) NOT NULL COMMENT '权限名称',
  `ACTION` VARCHAR(50) NOT NULL COMMENT '对应资源的操作',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）'
#    TODO:索引根据具体查询，后期再加
)ENGINE = INNODB AUTO_INCREMENT = 1 DEFAULT CHARSET=UTF8 COMMENT = '系统权限表';



CREATE TABLE AUTH_USER_ROLE(
  `ID` INT NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
  `USER_ID` INT NOT NULL COMMENT '用户ID',
  `ROLE_ID` INT NOT NULL COMMENT '角色ID',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  FOREIGN KEY REF_USER_KEY (USER_ID) REFERENCES AUTH_USER (ID),
  FOREIGN KEY REF_ROLE_KEY (ROLE_ID) REFERENCES AUTH_ROLE (ID)
#    TODO:索引根据具体查询，后期再加
)ENGINE = INNODB AUTO_INCREMENT = 1 DEFAULT CHARSET=UTF8 COMMENT =  '系统\'用户-角色\'对应表';


CREATE TABLE AUTH_ROLE_PERMISSION(
  `ID` INT NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
  `ROLE_ID` INT NOT NULL COMMENT '角色ID',
  `PERMISSION_ID` INT NOT NULL COMMENT '权限ID',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  FOREIGN KEY REF_ROLE_KEY2 (ROLE_ID) REFERENCES AUTH_ROLE (ID),
  FOREIGN KEY REF_MENU_KEY2 (PERMISSION_ID) REFERENCES AUTH_PERMISSION (ID)
#    TODO:索引根据具体查询，后期再加
)ENGINE = INNODB AUTO_INCREMENT = 1 DEFAULT CHARSET=UTF8 COMMENT = '系统\'角色-权限\'对应表';


# 1：添加用户信息


# 初始化用户(username:superadmin   password:123456);md5(123456) =  e10adc3949ba59abbe56e057f20f883e
SET @SALT = TIMESTAMPDIFF(SECOND, '1970-1-1 8:0:0', CURDATE());
SET @SALT = MD5(@SALT);
SET @PASSWORD = '123456';
SET @PASSWORD = MD5(CONCAT(MD5(@PASSWORD),@SALT));
INSERT INTO AUTH_USER(UID,USERNAME,AGE,TEL,PASSWORD,SALT)
    VALUES ('3013218145','汤宏垚',22,'15620947182',@PASSWORD,@SALT),
           ('3013218138','郝晓田',22,'15620947182',@PASSWORD,@SALT),
           ('3013218149','吴桐',22,'15620947182',@PASSWORD,@SALT),
           ('3013218135','邓斯舜',22,'15620947182',@PASSWORD,@SALT);

# 2： 添加角色信息

# 超级管理员
INSERT INTO AUTH_ROLE(ID,NAME,E_NAME)
    VALUES (1,'校长','xiaozhang');

# 管理员
INSERT INTO AUTH_ROLE(ID,NAME,E_NAME)
VALUES (2,'副校长','fuxiaozhang');

# 高级用户
INSERT INTO AUTH_ROLE(ID,NAME,E_NAME)
VALUES (3,'教导主任','jiaodaozhuren');

# 普通用户
INSERT INTO AUTH_ROLE(ID,NAME,E_NAME)
VALUES (4,'教师','teacher');


# 3：添加用户角色对应关系
INSERT INTO AUTH_USER_ROLE(USER_ID, ROLE_ID)
    VALUES (1,1);

INSERT INTO AUTH_USER_ROLE(USER_ID, ROLE_ID)
VALUES (2,2);

INSERT INTO AUTH_USER_ROLE(USER_ID, ROLE_ID)
VALUES (3,3);

INSERT INTO AUTH_USER_ROLE(USER_ID, ROLE_ID)
VALUES (4,4);


# 4：添加权限信息

# 1）resource： 用户
# create
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(1,'所有用户（包括管理员）：添加','user:create:*');

INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(2,'网站用户（不包括管理员）：添加','user:create:subscribers');


# delete
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(3,'用户：删除','user:delete:*');


# update
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(4,'所有用户（包括管理员）：修改','user:update:*');

INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(5,'网站用户（不包括管理员）：修改','user:update:subscribers');


# browse
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(6,'所有用户（包括管理员）：浏览','user:browse:*');

INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(7,'网站用户（不包括管理员）：浏览','user:browse:subscribers');

# 还有一个 requireOwner，超级用户与普通用户，只能查看个人的信息


# 2）resource：乐器
# create
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(8,'乐器：添加','instrument:create');

# delete
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(9,'乐器：删除','instrument:delete');

# update
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(10,'乐器：修改','instrument:update');

# browse
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(11,'乐器：查看','instrument:browse');


# 3）resource：资料
# create
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(12,'资料：添加','material:create');

# delete
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(13,'资料：删除','material:delete');

# update
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(14,'资料：修改','material:update');

# browse 缩略图
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(15,'资料：查看：缩略图片','material:browse:image');

# download (image,audio,video,analysis)
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(16,'资料：下载：高清图片','material:download:image');

INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(17,'资料：下载：音频','material:download:audio');

INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(18,'资料：下载：视频','material:download:video');

INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(19,'资料：下载：分析资料','material:download:analysis');

INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(20,'资料：下载：*','material:download:*');

# 超级管理员：所有权限
INSERT INTO AUTH_PERMISSION(ID,NAME,ACTION)
VALUES(21,'所有权限','*');

# 5：添加角色权限对关系
# 超级管理员
INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (1,21);


# 管理员
INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,2);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,5);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,7);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,8);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,10);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,11);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,12);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,14);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,15);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,16);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,17);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,18);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,19);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (2,20);

# 高级用户
INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (3,16);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (3,17);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (3,18);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (3,19);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (3,20);




# 普通用户
INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (4,16);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (4,17);

INSERT INTO AUTH_ROLE_PERMISSION(ROLE_ID, PERMISSION_ID)
VALUES (4,18);


-- 请假申请信息表
CREATE TABLE APPLICATION(
  `A_ID` bigInt NOT NULL AUTO_INCREMENT COMMENT '自增id',
  `A_UID` varchar(120) NOT NULL COMMENT '请假人工号',
  `A_VID` TINYINT NOT NULL COMMENT '假期类型',
  `A_DATE` varchar(120) NOT NULL COMMENT '请假日期',
  `A_COUNT` TINYINT NOT NULL COMMENT '请假天数',
  `A_REASON` text NOT NULL COMMENT '请假原因',
  `A_INFO` varchar(120) NULL COMMENT '备注信息',
  `A_PROVER` TINYINT NOT NULL COMMENT '批复人角色id',
  `A_STATUS` TINYINT NOT NULL DEFAULT 0 COMMENT '请假申请状态，0（未通过），1（已通过，未销假），2（已销假），-1（已拒绝）',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）',
  PRIMARY KEY(A_ID)
)ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT '请假申请表';

INSERT INTO APPLICATION(A_UID, A_VID, A_DATE, A_COUNT, A_REASON, A_INFO, A_STATUS, A_PROVER)
VALUES ('3013218145',1,'20161219',1,'教学调研','暂无',1,1),
       ('3013218145',2,'20161220',2,'教学调研','暂无',2,2),
       ('3013218145',3,'20161219',3,'教学调研','暂无',-1,3),
       ('3013218145',4,'20161219',4,'教学调研','暂无',0,3);

-- 假期类型信息表
CREATE TABLE VACATION(
  `V_ID` TINYINT NOT NULL COMMENT '假期编号',
  `V_NAME` varchar(120) NOT NULL COMMENT '假期名字',
  `V_INFO` varchar(255) NOT NULL COMMENT '备注信息',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）',
  PRIMARY KEY(V_ID)
)ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT '假期信息表';

-- 初始信息
INSERT INTO VACATION(V_ID, V_NAME, V_INFO)
VALUES (1, '公假', '1.	全薪'),
       (2, '事假', '1.	一次不超过3天 2.	一学期不超过7天 3.	半薪'),
       (3, '病假', '1.	需提供证明'),
       (4, '婚嫁', '1.	晚婚（男25，女23）增加晚婚奖励7天'),
       (5, '产假', '1.	24周岁以上女教职员工第一次生育，增加产假30天 2.	多胎生育，每多一胎加15天产假 3.	难产有医生证明的，增加产假15天'),
       (6, '丧假', '1.	直系亲属死亡时，丧假7天'),
       (7, '工伤假', '1.	需提供证明');

-- 创建资料附件表
CREATE TABLE PROOF(
  `P_ID` bigInt NOT NULL AUTO_INCREMENT COMMENT '资料附件id',
  `P_AID` bigInt NOT NULL COMMENT '请假申请id',
  `P_NAME` varchar(120) NOT NULL COMMENT '资料名称',
  `P_URL` varchar(120) NOT NULL COMMENT '资料URL',
  `P_TEMP_URL` varchar(120) NOT NULL COMMENT '资料TEMP_PATH',
  `P_SIZE` varchar(120) NOT NULL COMMENT '资料文件大小',
  `P_TYPE` VARCHAR(120) NOT NULL COMMENT '附件类型',
  `P_TYPE_NUM` TINYINT NOT NULL COMMENT '附件类型值:0 图片,1 音频,2 视频,3 分析',
  `P_MEDIA_TYPE` VARCHAR(120) NOT NULL COMMENT '媒体类型',
  `P_ORIGIN_NAME` VARCHAR(120) NOT NULL COMMENT '源文件名',
  `P_FILE_MD5` VARCHAR(120) NOT NULL COMMENT '文件md5值',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）',
  PRIMARY KEY (P_ID)
)ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT '资料附件表';

-- 创建津贴表
CREATE TABLE BONUS(
  `B_ID` bigInt NOT NULL AUTO_INCREMENT COMMENT '津贴id',
  `B_UID` varchar(120) NOT NULL COMMENT '教职员工号',
  `B_MONTH` varchar(120) NOT NULL COMMENT '年月',
  `B_BONUS` INT NOT NULL DEFAULT 0 COMMENT '津贴',
  `B_REPLACEA` INT NOT NULL DEFAULT 0 COMMENT '代课次数',
  `B_REPLACEB` INT NOT NULL DEFAULT 0 COMMENT '申请代课次数',
  `B_HALF` INT NOT NULL DEFAULT 0 COMMENT '半薪日数',
  `B_ZERO` INT NOT NULL DEFAULT 0 COMMENT '零薪日数',
  `B_INFO` varchar(255) COMMENT '备注',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）',
  PRIMARY KEY (B_ID)
)ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT '津贴表';

INSERT INTO BONUS(B_UID, B_MONTH,B_INFO)
VALUES('3013218145','2016-11','暂无'),
      ('3013218145','2016-12','暂无');

-- 创建代课表
CREATE TABLE REPLACETABLE(
  `R_ID` bigInt NOT NULL AUTO_INCREMENT COMMENT '代课表id',
  `R_UID1` varchar(120) NOT NULL COMMENT '需要代课的教职员工号',
  `R_UID2` varchar(120) NOT NULL COMMENT '代课教职员工号',
  `R_TIME` varchar(120) NOT NULL COMMENT '代课时间',
  `R_CLASS` VARCHAR(255) NOT NULL COMMENT '代课班级信息',
  `R_INFO` varchar(255) COMMENT '备注',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `DELETE_MARK` TINYINT NOT NULL DEFAULT 0 COMMENT '删除标志：0（正常）；-1（已删除）',
  PRIMARY KEY (R_ID)
)ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT '代课表';
